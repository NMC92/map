<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Portugal</title>
    </head>
    <body style="">
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

		<object class="map" id="svgmap" type="image/svg+xml" data="map.svg">
		</object>
		<span id="span"></span>
		<button type="button" id="game" >Play!</button>
		<button type="button" id="reset" >Reset</button>
		<span id="goalText"></span>
		<script>
			setTimeout(function(){
				const width = 250;
				const height = 366;
				const a = document.getElementById("svgmap");
				const svgDoc = a.contentDocument;
				const Portugal = svgDoc.getElementsByClassName('País');
				const Distritos = svgDoc.getElementsByClassName('Distritos');
				const Exclaves = svgDoc.getElementsByClassName('exclave');
				const Ilhas = svgDoc.getElementsByClassName('ilha');
				const Exfregs = svgDoc.getElementsByClassName('exfreg');
				const Locs= svgDoc.getElementsByClassName('locs');
				const Pins = svgDoc.getElementsByClassName('pins');
				let dists = new Array();
				let concs = new Array();
				let fregsall = new Array();
				let fregs = new Array();
				let exfregs = new Array();
				let locs = new Array();
				let dp = new Array();
				let dd = new Array();
				let dc = new Array();
				let df = new Array();
				let def = new Array();
				let dl = new Array();
				let dpins = new Array();
				let selPin = '';
				let tempBox = {H:0,W:0,X:0,Y:0}
				for(let q = 0; q < Pins.length; q=q+2)
					dpins.push({Id:Pins[q].attributes[3].value,Desc:Pins[q+1].attributes[4].value, Image:Pins[q+1].attributes[5].value, Pin: Pins[q].attributes[0].value, W: Pins[q+1].attributes[8].value, H: Pins[q+1].attributes[7].value});
				for(let i = 0; i < Distritos.length; i++)
				{
					let strAux = Distritos[i].id.split('(')[0];
					strAux = strAux == "Bragança" ? "Braganca" : strAux;
					strAux = strAux == "Castelo Branco" ? "CB" : strAux;
					strAux = strAux == "Évora" ? "Evora" : strAux;
					strAux = strAux == "Santarém" ? "Santarem" : strAux;
					strAux = strAux == "Setúbal" ? "Setubal" : strAux;
					strAux = strAux == "Viana do Castelo" ? "VC" : strAux;
					strAux = strAux == "Vila Real" ? "VR" : strAux;
					for(let j = 0; j < svgDoc.getElementsByClassName(strAux).length; j++)
					{   
						test = svgDoc.getElementsByClassName(strAux)[j].id;
						test = test.replace(/ +/g, "");
						test = test.toLowerCase();
						test = test.split('(')[0]+"freg";
						for(let k = 0; k < svgDoc.getElementsByClassName(test).length; k++)
						{
							if(!(svgDoc.getElementsByClassName(test)[k].id in Exclaves || svgDoc.getElementsByClassName(test)[k].id in Ilhas || svgDoc.getElementsByClassName(test)[k].id in Exfregs || svgDoc.getElementsByClassName(test)[k].id in Locs))
								fregs.push({Name:svgDoc.getElementsByClassName(test)[k].id,Concelho:svgDoc.getElementsByClassName(strAux)[j].id.split('(')[0],Distrito:Distritos[i].id.split('(')[0], Freguesia:svgDoc.getElementsByClassName(test)[k]});
							else if(svgDoc.getElementsByClassName(test)[k].id in Exfregs)
								exfregs.push({Name:svgDoc.getElementsByClassName(test)[k].id,Concelho:svgDoc.getElementsByClassName(strAux)[j].id.split('(')[0],Distrito:Distritos[i].id.split('(')[0], Freguesia:svgDoc.getElementsByClassName(test)[k]});
							else if(svgDoc.getElementsByClassName(test)[k].id in Locs)
								locs.push({Name:svgDoc.getElementsByClassName(test)[k].id,Concelho:svgDoc.getElementsByClassName(strAux)[j].id.split('(')[0],Distrito:Distritos[i].id.split('(')[0], Localidade:svgDoc.getElementsByClassName(test)[k]});
							fregsall.push({Name:svgDoc.getElementsByClassName(test)[k].id,Concelho:svgDoc.getElementsByClassName(strAux)[j].id.split('(')[0],Distrito:Distritos[i].id.split('(')[0], Freguesia:svgDoc.getElementsByClassName(test)[k]});
						}
						concs.push({Name:svgDoc.getElementsByClassName(strAux)[j].id,Distrito:Distritos[i].id.split('(')[0],Concelho:svgDoc.getElementsByClassName(strAux)[j],Freguesias:svgDoc.getElementsByClassName(test)});
					}
					dists.push({Name:Distritos[i].id,Distrito:Distritos[i],Concelhos:svgDoc.getElementsByClassName(strAux),Freguesias:svgDoc.getElementsByClassName("freg"+strAux.toLowerCase())});
				};
				
				dp.push({Path:Portugal[0].attributes[0].value, Id:Portugal[0].id});
				
				for(let i = 0; i < dists.length; i++)
					dd.push({Path:dists[i].Distrito.attributes[0].value,Id:Distritos[i].id});
				for(let i = 0; i < concs.length; i++)
					dc.push({Path:concs[i].Concelho.attributes[0].value,Id:concs[i].Name});
				for(let i = 0; i < fregsall.length; i++)
					if(!(fregsall[i].Name.includes('exfreg')))
						df.push({Path:fregsall[i].Freguesia.attributes[0].value,Id:fregsall[i].Name});
				for(let i = 0; i < exfregs.length; i++)
					def.push({Path:exfregs[i].Freguesia.attributes[0].value,Id:exfregs[i].Name});
				for(let i = 0; i < locs.length; i++)
					dl.push({Path:locs[i].Localidade.attributes[0].value,Id:locs[i].Name});
				for(let cfregs = 0; cfregs<dists.length;cfregs++)
					console.log("Freguesias de " + dists[cfregs].Name.split('(')[0] + ": " + filterItems(dists[cfregs].Name.split('(')[0]).length);
				console.log("\nTotal de freguesias: " + parseInt(fregs.length));
				const span = document.getElementById("span");
				const btn = document.getElementById("reset");
				const play = document.getElementById("game");
				const goalText = document.getElementById("goalText");
				btn.style.visibility="hidden";
				
				let x = Math.floor((Math.random() * fregsall.length)+1);
				//let goal = Concelhos[x].id;
				let guess = "";
				let tries = Number.MAX_SAFE_INTEGER;
				let lose = false;
				let game = false;
				
				for(let i = 0; i < dists.length; i++)
					dists[i].Distrito.attributes[0].value = "";
				for(let i = 0; i < concs.length; i++)
					concs[i].Concelho.attributes[0].value = "";
				for(let i = 0; i < fregsall.length; i++)
					fregsall[i].Freguesia.attributes[0].value = "";
				for(let i = 0; i < fregs.length; i++)
					fregs[i].Freguesia.attributes[0].value = "";
				for(let i = 0; i < exfregs.length; i++)
					exfregs[i].Freguesia.attributes[0].value = "";
				for(let i = 0; i < locs.length; i++)
					locs[i].Localidade.attributes[0].value = "";
				function hideIcons()
				{
					for(let i = 1; i < Pins.length; i=i+2)
					{	
						Pins[i].attributes[5].value = "";
						Pins[i].attributes[7].value = 0;
						Pins[i].attributes[8].value = 0;
					}
					for(let i = 0; i < Pins.length; i=i+2)
						Pins[i].attributes[0].value = "";
				}
				hideIcons();
				
				function answer(a, b){ return (a === b); }
				
				function bigger(a, b){ return (a >= b ? a : b); }
				
				function smaller(a, b){ return (a < b ? a : b); }
				
				function filterItems(dist) 
				{
					return fregs.filter(function(el) 
					{
						return el.Distrito.toLowerCase() === dist.toLowerCase();
					})
				}
				
				function filterExFregs(freg) 
				{
					return exfregs.filter(function(el) 
					{
						return freg.toLowerCase().includes(el.Freguesia.id.split('(')[0].toLowerCase());
					})
				}
				
				function filterLocs(freg) 
				{
					return locs.filter(function(el) 
					{
						return freg.toLowerCase() === el.Localidade.id.split('#')[1].split(')')[0].toLowerCase();
					})
				}
				
				function cleanConcelhos()
				{
					cleanFreguesias();
					cleanExFreguesias();
					cleanLocalidades();
					for(let i = 0; i < dists.length; i++)
						for(let j = 0; j < dists[i].Concelhos.length; j++)
							dists[i].Concelhos[j].attributes[0].value = "";
				}
				
				function cleanFreguesias()
				{
					for(let i = 0; i < fregsall.length; i++)
						fregsall[i].Freguesia.attributes[0].value = "";
					hideIcons();
				}
				
				function cleanExFreguesias()
				{
					for(let i = 0; i < exfregs.length; i++)
						exfregs[i].Freguesia.attributes[0].value = "";
				}
				
				function cleanLocalidades()
				{
					for(let i = 0; i < locs.length; i++)
						locs[i].Localidade.attributes[0].value = "";
				}
				
				btn.addEventListener("click", reset); 
				
				function reset() 
				{ 
					selPin = '';
					cleanConcelhos();
					btn.style.visibility="hidden";
					span.innerHTML = "";
					//span.innerHTML = `Where is ${goal}?`; 
					//if(game) 
						svgDoc.children[0].setAttribute(`viewBox`, `0 0 ${width} ${height}`);
					/*else
					{
						tries = 3
						x = Math.floor((Math.random() * 278)+1);
						goal = Concelhos[x].id;
						svgDoc.children[0].setAttribute(`viewBox`, `0 0 ${width} ${height}`);
						span.innerHTML = `Where is ${goal}?`;
						//game = true;
					}*/
				}
				
				function func(arr, str)
				{
					return arr.find(p => p.Id.includes(str.replace(/ /g, '_')));
				}
				function showDists()
				{	
					Portugal[0].attributes[0].value = "";
					for(let i = 0; i < dists.length; i++)
					{
						dists[i].Distrito.attributes[0].value = dd[i].Path;
						dists[i].Distrito.addEventListener("click", function(el) 
						{
							btn.style.visibility="visible";
							let x = el.clientX;
							let y = el.clientY;
							
							cleanConcelhos();
							let tgt = el.target.getBBox();
							let z = 180 / (tgt.width + tgt.height);
							svgDoc.children[0].setAttribute(`viewBox`, `${tgt.x-((width/z)/2)} ${tgt.y-((height/z)/2)} ${width/z} ${height/z}`);
							span.innerHTML = el.target.id;
							for(let j = 0; j < dists[i].Concelhos.length; j++)
							{
								dists[i].Concelhos[j].attributes[0].value = dc.find(x => x.Id === dists[i].Concelhos[j].id).Path;
								dists[i].Concelhos[j].addEventListener("click", el2 => 
								{
									/*if(game)
									{
										if(answer(el2.target.id, goal))
										{
											tries = 3
											game=false;
											span.innerHTML = `Win(${el2.target.id})!`;
											btn.style.visibility="visible";
										}
										else
										{
											tries--;
											span.innerHTML = `Wrong(${el2.target.id})! Lives = ${tries}.`;
											if(tries <= 0)
											{
												game=false;
												span.innerHTML += `\nLose...`;
											}
										}
									}
									else */
									let click = false;
									let tgt2 = el2.target.getBBox();
									let z = 185 / (tgt2.width + tgt2.height);
									svgDoc.children[0].setAttribute(`viewBox`, `${tgt2.x-((width/z)/2)} ${tgt2.y-((height/z)/2)} ${width/z} ${height/z}`);
									span.innerHTML = el2.target.id;
									cleanFreguesias();
									cleanExFreguesias();
									let currConc = concs.find(x => x.Name === dists[i].Concelhos[j].id);
									for(k = 0; k < currConc.Freguesias.length; k++)
									{
										if(!(currConc.Freguesias[k].id.includes('exfreg') || currConc.Freguesias[k].id.includes('loc#') || currConc.Freguesias[k].id.includes('resid#')) === true)
											currConc.Freguesias[k].attributes[0].value = df.find(x => x.Id === concs.find(x => x.Name === dists[i].Concelhos[j].id).Freguesias[k].id).Path;
										//else
											//console.log(currConc.Freguesias[k].id);
										currConc.Freguesias[k].addEventListener("click", el3 =>
										{
											selPin = '';
											if(!(el3.target.id.includes('exfreg') || el3.target.id.includes('#')))
												cleanExFreguesias();
											if(!(el3.target.id.includes('#')))
												cleanLocalidades();
											span.innerHTML = el3.target.id;
											if (typeof dpins.find(d => d.Id.includes(el3.target.id.split('(')[0].replace(/ /g, '_'))) !== "undefined")
											{
												if(!(el3.target.id.includes('exfreg') || el3.target.id.includes('#')))
													hideIcons();
												if(!(el3.target.id.includes('loc#')))
												{
													let tgt3 = el3.target.getBBox();
													let z = 200 / (tgt3.width + tgt3.height);
													svgDoc.children[0].setAttribute(`viewBox`, `${tgt3.x-((width/z)/2)} ${tgt3.y-((height/z)/2)} ${width/z} ${height/z}`);
												}
												let l;
												for(l = 0; l < Pins.length; l=l+2)
												{
													if(dpins[l/2].Id.includes(el3.target.id.replace(/ /g, '_')))
													{
														selPin = '';
														click = true;
														Pins[l].attributes[0].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).Pin;
														Pins[l+1].attributes[5].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).Image;
														Pins[l+1].attributes[7].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).H;
														Pins[l+1].attributes[8].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).W;		
														if(selPin == '')
														{
															Pins[l].addEventListener("mouseover", el5 =>
															{
																let m;
																if(selPin === '')
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
															});
															Pins[l].addEventListener("mouseout", el5 =>
															{
																let m;
																if(selPin === '')
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 1;
															});
															Pins[l].addEventListener("click", el5 =>
															{	
																if(el5.target.id.split(':')[0] === selPin.split(':')[0])
																{
																	selPin = '';
																	let idx = dpins.indexOf(dpins.find(d => d.Id === el5.target.attributes[3].value));
																	let tgt5 = Pins[(idx*2)+1].getBBox();
																	let z = 160 / (tgt5.width + tgt5.height);
																	svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																	span.innerHTML = dpins[idx].Desc;
																	let m;
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
																}
																else if(selPin === '')
																{
																	selPin = el5.target.id;
																	let idx = dpins.indexOf(dpins.find(d => d.Id === el5.target.attributes[3].value));
																	let tgt5 = Pins[(idx*2)+1].getBBox();
																	let z = 160 / (tgt5.width + tgt5.height);
																	svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																	span.innerHTML = dpins[idx].Desc;
																	let m;
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
																}
																
															});
															Pins[l+1].addEventListener("mouseover", el5 =>
															{
																let m;
																if(selPin === '')
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
															});
															Pins[l+1].addEventListener("mouseout", el5 =>
															{
																let m;
																if(selPin === '')
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 1;
															});
															
															Pins[l+1].addEventListener("click", el5 =>
															{
																if(el5.target.id.split(':')[0] === selPin.split(':')[0])
																{
																	selPin = '';
																	let tgt5 = el5.target.getBBox();
																	let z = 160 / (tgt5.width + tgt5.height);
																	svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																	span.innerHTML = el5.target.attributes[4].value;
																	let m;
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
																}
																else if(selPin === '')
																{
																	selPin = el5.target.id;
																	let tgt5 = el5.target.getBBox();
																	let z = 160 / (tgt5.width + tgt5.height);
																	svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																	span.innerHTML = el5.target.attributes[4].value;
																	let m;
																	for(m = 0; m < Pins.length; m++)
																		if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																			Pins[m].style.opacity = 0.025;
																}
															});
															
														}
													}
												}
											}
											else if(click && (exfregs.find(x => el3.target.id.includes(x.Name.split('(')[0])) !== undefined || locs.find(x => el3.target.id.includes(x.Name.split('#')[1].split(')')[0])) !== undefined) && !el3.target.id.includes('#'))
											{
												let tgt7 = el3.target.getBBox();
												let z = 200 / (tgt7.width + tgt7.height);
												svgDoc.children[0].setAttribute(`viewBox`, `${tgt7.x-((width/z)/2)} ${tgt7.y-((height/z)/2)} ${width/z} ${height/z}`);
												if(!(el3.target.id.includes('#'))) 
													hideIcons();
											}
											else if(el3.target.id.includes('#'))
											{
												let tgt8 = tempBox;
												let z = 200 / (tgt8.W + tgt8.H);
												svgDoc.children[0].setAttribute(`viewBox`, `${tgt8.X-((width/z)/2)} ${tgt8.Y-((height/z)/2)} ${width/z} ${height/z}`);
											}
											let filtEf = filterExFregs(el3.target.id);
											if(filtEf.length > 0)
											{
												for(let l = 0; l < filtEf.length; l++)
												{
													let ef = exfregs.find(x => x.Freguesia.id === filtEf[l].Name);
													ef.Freguesia.attributes[0].value = def.find(x => x.Id === filtEf[l].Name).Path;
													ef.Freguesia.addEventListener("click", el4 =>
													{
														span.innerHTML = el4.target.id.split('(')[0] + '(Ex freguesia)';
														let tgt4 = el4.target.getBBox();
														let z = 200 / (tgt4.width + tgt4.height);
														svgDoc.children[0].setAttribute(`viewBox`, `${tgt4.x-((width/z)/2)} ${tgt4.y-((height/z)/2)} ${width/z} ${height/z}`);
														let fLocs = filterLocs(el4.target.id.split('(')[0]);
														for(let i = 0; i < fLocs.length; i++)
														{
															if(fLocs.length > 0)
															{
																tempBox.H = tgt4.height;
																tempBox.W = tgt4.width;
																tempBox.X = tgt4.x;
																tempBox.Y = tgt4.y;
																let loc = locs.find(x => x.Localidade.id === fLocs[i].Name);
																loc.Localidade.attributes[0].value = dl.find(x => x.Id === fLocs[i].Name).Path;
																loc.Localidade.addEventListener("click", el5 =>
																{
																	if(fLocs[i].Name.includes('resid'))
																		span.innerHTML = 'Residual';
																	else
																		span.innerHTML = fLocs[i].Name.split('(')[0];
																});
															}
														}
													});
													}
											}
											else
											{
												if(locs.find(x => el3.target.id.includes(x.Name.split('#')[1].split(')')[0])) !== undefined)
												{
													let tgt6 = el3.target.getBBox();
														let z = 200 / (tgt6.width + tgt6.height);
														svgDoc.children[0].setAttribute(`viewBox`, `${tgt6.x-((width/z)/2)} ${tgt6.y-((height/z)/2)} ${width/z} ${height/z}`);
													let fLocs = filterLocs(el3.target.id);
													for(let i = 0; i < fLocs.length; i++)
													{
														let loc = locs.find(x => x.Localidade.id === fLocs[i].Name);
														loc.Localidade.attributes[0].value = dl.find(x => x.Id === fLocs[i].Name).Path;
														loc.Localidade.addEventListener("click", el5 =>
														{
															let tgt5 = el5.target.getBBox();
															let z = 200 / (tgt5.width + tgt5.height);
															svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
															if(fLocs[i].Name.includes('resid'))
																span.innerHTML = 'Residual';
															else
																span.innerHTML = fLocs[i].Name.split('(')[0];
														});
													}
												}
												if (typeof dpins.find(d => d.Id.includes(el3.target.id.replace(/ /g, '_'))) !== "undefined")
												{
													hideIcons();
													let l;
													for(l = 0; l < Pins.length; l=l+2)
													{
														if(dpins[l/2].Id.includes(el3.target.id.replace(/ /g, '_')))
														{
															selPin = '';
															click = true;
															Pins[l].attributes[0].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).Pin;
															Pins[l+1].attributes[5].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).Image;
															Pins[l+1].attributes[7].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).H;
															Pins[l+1].attributes[8].value = dpins.find(d => d.Id === Pins[l].attributes[3].value).W;
															
															if(selPin == '')
															{
																Pins[l].addEventListener("mouseover", el5 =>
																{
																	let m;
																	if(selPin === '')
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																});
																Pins[l].addEventListener("mouseout", el5 =>
																{
																	let m;
																	if(selPin === '')
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 1;
																});
																Pins[l].addEventListener("click", el5 =>
																{	
																	if(el5.target.id.split(':')[0] === selPin.split(':')[0])
																	{
																		selPin = '';
																		let idx = dpins.indexOf(dpins.find(d => d.Id === el5.target.attributes[3].value));
																		let tgt5 = Pins[(idx*2)+1].getBBox();
																		let z = 160 / (tgt5.width + tgt5.height);
																		svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																		span.innerHTML = dpins[idx].Desc;
																		let m;
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																	}
																	
																	else if(selPin === '')
																	{
																		selPin = el5.target.id;
																		let idx = dpins.indexOf(dpins.find(d => d.Id === el5.target.attributes[3].value));
																		let tgt5 = Pins[(idx*2)+1].getBBox();
																		let z = 160 / (tgt5.width + tgt5.height);
																		svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																		span.innerHTML = dpins[idx].Desc;
																		let m;
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																	}
																});
																Pins[l+1].addEventListener("mouseover", el5 =>
																{
																	let m;
																	if(selPin === '')
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																});
																Pins[l+1].addEventListener("mouseout", el5 =>
																{
																	let m;
																	if(selPin === '')
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 1;
																});
																
																Pins[l+1].addEventListener("click", el5 =>
																{
																	if(el5.target.id.split(':')[0] === selPin.split(':')[0])
																	{
																		selPin = '';
																		let tgt5 = el5.target.getBBox();
																		let z = 150 / (tgt5.width + tgt5.height);
																		svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																		span.innerHTML = el5.target.attributes[4].value;
																		let m;
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																	}
																	else if(selPin === '')
																	{
																		selPin = el5.target.id;
																		let tgt5 = el5.target.getBBox();
																		let z = 150 / (tgt5.width + tgt5.height);
																		svgDoc.children[0].setAttribute(`viewBox`, `${tgt5.x-((width/z)/2)} ${tgt5.y-((height/z)/2)} ${width/z} ${height/z}`);
																		span.innerHTML = el5.target.attributes[4].value;
																		let m;
																		for(m = 0; m < Pins.length; m++)
																			if(Pins[m].attributes[3].value.includes(el3.target.id.replace(/ /g, '_')) && !(Pins[m].attributes[3].value.split(':')[0] === el5.target.attributes[3].value.split(':')[0]))
																				Pins[m].style.opacity = 0.025;
																	}
																	});
																
															}
														}
													}
												}
												else if(click)
												{
													let z = 185 / (tgt2.width + tgt2.height);
													svgDoc.children[0].setAttribute(`viewBox`, `${tgt2.x-((width/z)/2)} ${tgt2.y-((height/z)/2)} ${width/z} ${height/z}`);
													hideIcons();
												}
											}
										});
									}
								});
						}
						});
					}
				}
				
				play.addEventListener("click", () => 
				{
						play.style.visibility="hidden";
						/*x = Math.floor((Math.random() * 278)+1);
						goal = Concelhos[x].id;
						span.innerHTML = `Where is ${goal}?`;
						guess = "";
						tries = 3;
						game = false;
						lose = false;*/
						showDists();
				});
				
			}, 2500);
		</script>
    </body>
</html>